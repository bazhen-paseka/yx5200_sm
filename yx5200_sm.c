/**
* \version 1.0
* \author Bazhen.Ele
* \date 16-II-2026
*************************************************************************************
* \copyright	Bazhen Levkovets
* \copyright	Brovary Kyiv Ukraine
* \copyright	bazhen.paseka@gmail.com
*************************************************************************************
*/

/*
**************************************************************************
*							INCLUDE FILES
**************************************************************************
*/
	#include "yx5200_sm.h"
/*
**************************************************************************
*							LOCAL DEFINES
**************************************************************************
*/

/*
**************************************************************************
*							LOCAL CONSTANTS
**************************************************************************
*/

/*
**************************************************************************
*						    LOCAL DATA TYPES
**************************************************************************
*/

/*
**************************************************************************
*							  LOCAL TABLES
**************************************************************************
*/

/*
**************************************************************************
*								 MACRO'S
**************************************************************************
*/
	#define MP3_BUFFER_SIZE 8
/*
**************************************************************************
*						 LOCAL GLOBAL VARIABLES
**************************************************************************
*/

/*
**************************************************************************
*                        LOCAL FUNCTION PROTOTYPES
**************************************************************************
*/
	uint8_t _yx5200_free (yx5200_struct yx5200_handler);
/*
**************************************************************************
*                           GLOBAL FUNCTIONS
**************************************************************************
*/

void MP3_YX5200_Init(yx5200_struct *yx5200_handler) {
	if (yx5200_handler == NULL) {
		return;
	}

	uint8_t mp3_buffer[MP3_BUFFER_SIZE] = {0x7E, 0xFF, 0x06, 0x09, 0x00, 0x00, 0x02, 0xEF};
	HAL_UART_Transmit(yx5200_handler->uart, (uint8_t *)mp3_buffer, MP3_BUFFER_SIZE, 100);
} //**************************************************************************

void MP3_YX5200_Play_with_index(yx5200_struct *yx5200_handler, uint16_t song_index_u16) {
	HAL_Delay(200);
	do {
		HAL_Delay(100);
	} while (_yx5200_free(*yx5200_handler) == 0);

	uint8_t mp3_buffer[MP3_BUFFER_SIZE] = {0x7E, 0xFF, 0x06, 0x03, 0x00, 0x00, 0x00, 0xEF};
	mp3_buffer[5] = (uint8_t)(song_index_u16>>8);
	mp3_buffer[6] = (uint8_t)(song_index_u16 & 0xFF);
	HAL_UART_Transmit(yx5200_handler->uart, (uint8_t *)mp3_buffer, MP3_BUFFER_SIZE, 100);
} //**************************************************************************

/*
**************************************************************************
*                           LOCAL FUNCTIONS
**************************************************************************
*/

uint8_t _yx5200_free (yx5200_struct yx5200_handler) {
	return HAL_GPIO_ReadPin(yx5200_handler.busy_port, yx5200_handler.busy_pin);
} //**************************************************************************

/*
**************************************************************************
*                             	END
**************************************************************************
*/











